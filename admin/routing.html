<script src="../bower_components/page/page.js"></script>
<script>
	window.addEventListener('WebComponentsReady', function () {
		page('/', function () {
			if (app.isAuthorized) {
				app.route = 'home';
			}
			else {
				app.displayLoginPage();
			}
		});

		page('/post/:postId', function (ctx) {
			if (app.isAuthorized) {
				app.route = 'home';
				app.fire('routeChanged', ctx.params.postId);
			}
			else {
				app.displayLoginPage();
			}
		});

		page('*', function (ctx) {
			app.route = "404";
		});

		/**
		 * Display the login page while not changing the actual route
		 */
		app.displayLoginPage = function() {
			app.lastRoute = app.route;
			app.route = "login";
		};

		app.restorePageAfterLogin = function() {
			if (app.lastRoute) {
				app.route = app.lastRoute;
				return;
			}
			app.route = "home";
		};

		page.base("/admin");

		//it will call page.start()
		page({
			hashbang: true // add #! before urls
		});

		//display the login page on sign out
		app.$.gsa.addEventListener("google-signin-aware-signed-out", app.displayLoginPage);

		/*app.handleSignIn = function() {
			console.log("google-login");
			//app.fire("google-login");
		};

		app.handleSignOut = function() {
			console.log("google-logout");
			//app.fire("google-logout");
		}*/
	});
</script>
