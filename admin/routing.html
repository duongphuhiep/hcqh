<script src="../bower_components/page/page.js"></script>
<script>
	/* TODO change in production */
	page.rootFolder = "/hcqh/";

	page.urlToAdminPhp = page.rootFolder + "backend/admin.php";
	page.base(page.rootFolder+"admin");

	window.addEventListener('WebComponentsReady', function () {
		page('/', function (ctx) {
			if (app.isAuthorized) {
				app.route = 'home';
			}
			else {
				app.displayLoginPage();
			}
		});

		page('/post/:postId', function (ctx) {
			if (app.isAuthorized) {
				app.route = 'home';
			}
			else {
				app.displayLoginPage();
			}
			app.postId = ctx.params.postId;
		});

		page('*', function (ctx) {
			app.route = "404";
		});

		/**
		 * Display the login page while not changing the actual route
		 */
		app.displayLoginPage = function() {
			if (app.route !== "login") {
				app.lastRoute = app.route;
			}
			app.route = "login";
		};

		app.restorePageAfterLogin = function() {
			if (app.lastRoute) {
				app.route = app.lastRoute;
				return;
			}
			app.route = "home";
		};

		//it will call page.start()
		page({
			hashbang: true // add #! before urls
		});

		//display the login page on sign out
		app.$.gsa.addEventListener("google-signin-aware-signed-out", app.displayLoginPage);

		/*app.handleSignIn = function() {
			console.log("google-login");
			//app.fire("google-login");
		};

		app.handleSignOut = function() {
			console.log("google-logout");
			//app.fire("google-logout");
		}*/
	});
</script>
