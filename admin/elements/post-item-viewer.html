<dom-module id="post-item-viewer">
    <template>
		<iron-ajax
			id="loader"
			method="GET"
			url=[[itemModel.filePath]]
			handle-as="text"
			last-response="{{content}}"
			debounce-duration="100"
			loading={{loading}}
			on-error = "_onError"></iron-ajax>
		<template is="dom-if" if="{{loading}}">
			<paper-progress indeterminate></paper-progress>
		</template>
		<template is="dom-if" if="[[itemModel.isMarkdown]]">
			<commonmark-editor working-dir=[[itemModel.parentPath]] value={{content}} height="700px"></commonmark-editor>
		</template>
		<template is="dom-if" if="[[itemModel.isImage]]">
			<!-- <img src="[[itemModel.filePath]]"> -->
			<iron-image src="[[itemModel.filePath]]"></iron-image>
		</template>

		<style>
			:host {
				display: block;
			}
			commonmark-editor {
				display: block;
				background: #fff;
				@apply(--shadow-elevation-2dp);
				height: 700px;
				margin: 10px;
			}
			paper-progress {
				width: 100%;
			}
		</style>
    </template>

    <script>
        Polymer({
            is: "post-item-viewer",

			properties: {
				itemModel: {
					value: Object,
					observer: "itemChanged"
				}
			},

			itemChanged: function(e) {
				if (e.isMarkdown) {
					this.$.loader.generateRequest();
				}
			},
			_onError: function(e) {
				this.fire("raise-alert-error", e.detail.error);
			}
        });
    </script>

</dom-module>
