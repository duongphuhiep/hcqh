<!--Main app-->
<dom-module id="home-page">
	<template>
		<paper-drawer-panel id="drawerPanel" responsive-width="1024px">

			<div class="nav" drawer>
				<post-collection></post-collection>
			</div>

			<paper-header-panel class="main" main mode="waterfall">
				<!-- Main Toolbar -->
				<paper-toolbar>
					<paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
					<div class="title">{{welcomeHeader}}</div>
					<google-signin id="gs" client-id="786362358731-q3s0lph8krhk90sc2bp1eujokfjbburt.apps.googleusercontent.com" scopes="profile"></google-signin>
				</paper-toolbar>

				<!-- Main Content -->
				<div class="content">
					<post-folder></post-folder>
					<div class="editor">
						<commonmark-editor># Bai viet so 1</commonmark-editor>
					</div>
				</div>

			</paper-header-panel>

		</paper-drawer-panel>

		<style is="custom-style">
			paper-drawer-panel {
				--paper-drawer-panel-left-drawer-container: {
					 background-color: lightgray;
				 };
			}

			.nav {
				overflow: scroll;
			}

			.editor {
				display: block;
				background: #fff;
				@apply(--shadow-elevation-2dp);
				height: 400px;
				margin: 10px;
			}

			:host {
			  display: block;
			}

			.nav {
			  border-right: 1px solid #ccc;
			}

			.main {
			  background-color: #eee;
			}
		</style>

	</template>

	<script>
		Polymer({
			ready: function() {
				//app.$.gsa.addEventListener('app.gsa.google-signin-aware-success', this._onSignIn);

				//this.listen('app.gsa.google-signin-aware-success', "_onSignIn");
			},

			is: 'home-page',
			listeners: {
				/*Here we caputure event coming from the button gs inside this component*/
				"gs.google-signin-aware-signed-out": "_onSignOut",
				'gs.google-signin-aware-success': "_onSignIn"

				/*we can also capture the global events comming from app.gsa*/
				/*"google-signin-aware-signed-out": "_onSignOut",
				'google-signin-aware-success': "_onSignIn"*/
			},

			_onSignIn: function(e) {
				var currentUser = gapi.auth2.getAuthInstance().currentUser.get();
				if (currentUser) {
					var profile = currentUser.getBasicProfile();
					if (profile) {
						this.welcomeHeader = "Hi, " + profile.getName() + " (" + profile.getId() + ")";
						//this.userAvatar = profile.getImageUrl();
						//this.userEmail = profile.getEmail();
						//var id_token = currentUser.getAuthResponse().id_token;
						return;
					}
				}
				console.error("Cannot retreive user info");
				page.redirect("/login");
			},

			_onSignOut: function() {
				page.redirect("/login");
			}
		});

	</script>

</dom-module>
