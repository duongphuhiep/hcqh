<!--
Main app

# Alert:
Any children elements can alert something in the alert-corner by sending raise-alert-* events
	this.fire("raise-alert-error", "Not supported operation");
-->
<dom-module id="home-page">
	<template>
		<style is="custom-style">
			paper-drawer-panel {
				--paper-drawer-panel-left-drawer-container: {
					background: lightgray;
				 };
			}
			.nav {
				overflow: scroll;
				border-right: 1px solid #ccc;
			}
			:host {
				display: block;
			}
			.main {
				background: lightgray;
			}
			.iron-selected {
				background: var(--default-primary-color);
			}
			item-title {
				display: block;
			}
			paper-drawer-panel {
				--item-list-item-title-display: block;
				--item-title-card-display: list-item;
			}
		</style>

		<paper-drawer-panel id="drawerPanel" responsive-width="1024px">

			<div class="nav" drawer>
				<iron-selector attr-for-selected="filePath"  selected-item-path=[[folderPath]] activate-event="">
					<item-title parent-path=[[parentOfBannerFolder]] file-name="banner" treat-as="folder" url-to-admin-php=[[urlToAdminPhp]]></item-title>
					<item-title parent-path=[[parentMembersFolder]] file-name="members" treat-as="folder" url-to-admin-php=[[urlToAdminPhp]]></item-title>
				</iron-selector>
				<item-list folder-path="[[blogFolder]]" url-to-admin-php=[[urlToAdminPhp]] treat-items-as="folder" selected-item-path=[[folderPath]]></item-list>
			</div>

			<paper-header-panel class="main" main mode="waterfall">
				<!-- Main Toolbar -->
				<paper-toolbar>
					<paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
					<div class="title">{{welcomeHeader}}</div>
					<google-signin id="gs" client-id="786362358731-q3s0lph8krhk90sc2bp1eujokfjbburt.apps.googleusercontent.com" scopes="profile"></google-signin>
				</paper-toolbar>

				<!-- Main Content -->
				<div class="content">
					<folder-content folder-path=[[folderPath]]
									url-to-admin-php=[[urlToAdminPhp]]
									file-name=[[fileName]]
									dirty={{dirty}}>
					</folder-content>
				</div>

			</paper-header-panel>
		</paper-drawer-panel>

		<alert-corner id="alertCorner" auto-close="10000"></alert-corner>

	</template>

	<script>
		Polymer({
			ready: function() {
				this.parentOfBannerFolder = page.helper.joinPath(page.contentFolder, 'home');
				this.parentMembersFolder = page.contentFolder;
			},

			is: 'home-page',

			properties: {
				blogFolder: String,
				folderPath: String,
				fileName: String,
				urlToAdminPhp: String,
				dirty: {
					type: Boolean,
					notify: true,
					value: false
				}
			},

			listeners: {
				/*Here we caputure event coming from the button gs inside this component*/
				//"gs.google-signin-aware-signed-out": "_onSignOut",
				'gs.google-signin-aware-success': "_onSignIn",

				/*we can also capture the global events comming from app.gsa*/
				/*"google-signin-aware-signed-out": "_onSignOut",
				'google-signin-aware-success': "_onSignIn"*/

				'raise-alert-info': "_raiseAlertInfo",
				'raise-alert-warning': "_raiseAlertWarning",
				'raise-alert-error': "_raiseAlertError"
			},

			/**
			 * Change the welcome header on signed in
			 */
			_onSignIn: function() {
				var currentUser = gapi.auth2.getAuthInstance().currentUser.get();
				if (currentUser) {
					var profile = currentUser.getBasicProfile();
					if (profile) {
						this.welcomeHeader = "Hi, " + profile.getName() + " (" + profile.getId() + ")";
						//this.userAvatar = profile.getImageUrl();
						//this.userEmail = profile.getEmail();
						//var id_token = currentUser.getAuthResponse().id_token;
						return;
					}
				}
				console.error("Cannot retreive user info");
				app.displayLoginPage();
			},

			/**
			 * display raise-alert event in the alert-corner
			 */
			_raiseAlertInfo: function(e) {
				this.$.alertCorner.showInfo(e.detail);
			},
			_raiseAlertWarning: function(e) {
				this.$.alertCorner.showWarning(e.detail);
			},
			_raiseAlertError: function(e) {
				this.$.alertCorner.showError(e.detail);
			}

		});

	</script>

</dom-module>
