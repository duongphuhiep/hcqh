<dom-module id="item-content">
    <template>
		<style is="custom-style">
			:host {
				display: block;
			}
			commonmark-editor {
				display: block;
				background: #fff;
				@apply(--shadow-elevation-2dp);
				height: 700px;
				margin: 20px 5%;
			}
			paper-progress {
				width: 100%;
			}
			paper-button {
				display: block;
				background: var(--default-primary-color);
				color: var(--text-primary-color);
				width: 100px;
				margin-left: auto;
				margin-right: auto;
			}
		</style>

		<iron-ajax
			id="loader"
			method="GET"
			url=[[itemTitle.filePath]]
			handle-as="text"
			last-response="{{content}}"
			debounce-duration="100"
			loading={{loading}}
			on-response="_onResponse"
			on-error = "_onError"></iron-ajax>
		<template is="dom-if" if="{{loading}}">
			<paper-progress indeterminate></paper-progress>
		</template>
		<template is="dom-if" if="[[itemTitle.isMarkdown]]">
			<commonmark-editor id="edit" working-dir=[[itemTitle.parentPath]] value={{dirtyContent}} height="700px" changed-by-user={{dirty}}></commonmark-editor>
			<paper-button raised><iron-icon icon="check"></iron-icon>Save</paper-button>
		</template>
		<template is="dom-if" if="[[itemTitle.isImage]]">
			<!-- <img src="[[itemTitle.filePath]]"> -->
			<iron-image src="[[itemTitle.filePath]]"></iron-image>
		</template>
    </template>

    <script>
        Polymer({
            is: "item-content",

			properties: {
				itemTitle: {
					value: Object,
					observer: "itemChanged"
				},
				dirty: {
					type: Boolean,
					notify: true,
					value: false
				}
			},

			itemChanged: function(e) {
				if (e && e.isMarkdown) {
					this.$.loader.generateRequest();
				}
				else {
					this.dirty = false; //reset the dirty state
				}
			},
			_onResponse: function(e) {
				if (this.itemTitle.isMarkdown) {
					this.dirtyContent = this.content; //reset the dirty content
				}
			},
			_onError: function(e) {
				this.fire("raise-alert-error", content);
			}
        });
    </script>

</dom-module>
