<dom-module id="item-content">
    <template>
		<style>
			:host {
				display: block;
			}
			commonmark-editor {
				display: block;
				background: #fff;
			@apply(--shadow-elevation-2dp);
				height: 700px;
				margin: 10px;
			}
			paper-progress {
				width: 100%;
			}
		</style>

		<iron-ajax
			id="loader"
			method="GET"
			url=[[itemTitle.filePath]]
			handle-as="text"
			last-response="{{content}}"
			debounce-duration="100"
			loading={{loading}}
			on-error = "_onError"></iron-ajax>
		<template is="dom-if" if="{{loading}}">
			<paper-progress indeterminate></paper-progress>
		</template>
		<template is="dom-if" if="[[itemTitle.isMarkdown]]">
			<commonmark-editor working-dir=[[itemTitle.parentPath]] value={{content}} height="700px"></commonmark-editor>
		</template>
		<template is="dom-if" if="[[itemTitle.isImage]]">
			<!-- <img src="[[itemTitle.filePath]]"> -->
			<iron-image src="[[itemTitle.filePath]]"></iron-image>
		</template>
    </template>

    <script>
        Polymer({
            is: "item-content",

			properties: {
				itemTitle: {
					value: Object,
					observer: "itemChanged"
				}
			},

			itemChanged: function(e) {
				if (e && e.isMarkdown) {
					this.$.loader.generateRequest();
				}
			},
			_onError: function(e) {
				this.fire("raise-alert-error", e.detail.error);
			}
        });
    </script>

</dom-module>
