<!--
Display a list of post
-->
<dom-module id="post-collection">
	<template>
		<iron-ajax
			auto
			method="POST",
			url=[[urlToAdminPhp]]
			content-type="application/json"
			body='{"action":"ls","path":"content/blog"}'
			handle-as="json"
			last-response="{{postsCollection}}"
			on-error = "_onError"
			loading={{loading}}
			debounce-duration="100"></iron-ajax>

		<template is="dom-if" if="{{loading}}">
			<paper-progress indeterminate></paper-progress>
		</template>
		<iron-selector attr-for-selected="fileName" on-selected-changed="_selectPost" selected={{postId}}>
			<template is="dom-repeat" items={{postsCollection}}>
				<file-item content-type="post-folder" file-name={{item}} fileName-changed="_rename" parent-path="content/blog"></file-item>
			</template>
		</iron-selector>
		<style>
			paper-progress {
				width: 100%;
			}
			file-item {
				display: block;
			}
			.iron-selected {
				background: var(--default-primary-color);
			}
		</style>
	</template>
	<script>
		Polymer({
			is: 'post-collection',

			ready: function() {
				this.urlToAdminPhp = page.urlToAdminPhp;
			},

			properties: {
				postId: String
			},

			listeners: {
				"refresh-collection": "_reload"
			},

			_reload: function(e) {
				this.postsCollection = e.detail.newCollection; //reload the collection
				if (e.detail.because === "ren") { //reload because of rename
					this.postId = e.detail.changedItem;
				}
				else if (e.detail.because === "rm") {  //reload because of remove
					//TODO set selection to something else
				}
			},

			_onError: function(e) {
				this.fire("raise-alert-error", e.detail.error);
			},

			_rename: function(e) {
				console.log("rename ", e);
			},

			/*_onClick: function(e) {
				//e.currentTarget refers to <file-item>, e.target refers to the div
			},*/

			_selectPost: function(e) {
				page("/post/"+e.detail.value);
			}
		});
	</script>

</dom-module>
